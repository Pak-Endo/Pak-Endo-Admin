<app-layout>
  <h1 class="text-2xl font-bold">Events</h1>
  <div class="flex justify-between mt-5 w-full">
    <div class="w-2/5 float-left">
      <tui-input
        tuiTextfieldIconLeft="tuiIconSearchLarge"
        [formControl]="searchValue"
        [tuiTextfieldCleaner]="true"
        class="shadow-md"
      >
        <p>Search by event title</p>
        <input
          tuiTextfield
          placeholder="Type to start searching..."
        />
      </tui-input>
    </div>
    <div class="w-1/5 flex justify-end">
      <button
        tuiButton
        icon="tuiIconPlusLarge"
        type="submit"
        appearance="custom"
        [showLoader]="false"
        class="bg-gradient-to-r from-[#234976] to-[#0F9449] text-white my-1"
      >
        Add event
      </button>
    </div>
  </div>
  <ng-container *ngIf="(events$ | async) as data; else loading">
    <div class="relative overflow-x-auto rounded-lg shadow-lg mb-7 mt-2">
      <table class="w-full text-sm text-left text-gray-500">
        <thead class="text-xs text-white uppercase bg-gradient-to-r from-[#234976] to-[#0F9449]">
          <tr>
            <th class="pl-4 py-3 text-sm">Title</th>
            <th class="px-2 py-3 text-sm">Starts On</th>
            <th class="px-2 py-3 text-sm">Ends On</th>
            <th class="px-2 py-3 text-sm">Stream URL</th>
            <th class="px-2 py-3 text-sm">Status</th>
            <th class="px-2 py-3 text-sm">Rating</th>
            <th scope="col" class="px-2 py-3 text-sm">
              Actions
            </th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="data?.events?.length == 0; else showEvents">
            <th colspan="12" role="row" class="px-5 py-10 text-lg text-center">
              No events available
            </th>
          </ng-container>
          <ng-template #showEvents>
            <ng-container *ngFor="let event of data?.events; let i = index; let first = first; let last = last; trackBy: trackByFn">
              <tr class="bg-white border-b border-gray-300 text-gray-600">
                <td class="pl-4 py-4 max-w-40">
                  {{event?.title}}
                </td> 
                <td class="px-2 py-4">
                  {{event?.startDate | date:'medium'}}
                </td> 
                <td class="px-2 py-4">
                  {{event?.endDate | date:'medium'}}
                </td> 
                <td class="px-2 py-4">
                  <ng-container *ngIf="event?.streamUrl != ''; else noStream">
                    <a href="https://google.com" target="_blank" class="bg-red-500 text-white px-2 py-1 rounded-md">
                      <tui-svg new size="xxs" src="tuiIconYoutube"></tui-svg>&nbsp; Visit
                    </a>
                  </ng-container>
                  <ng-template #noStream>
                    No stream available
                  </ng-template>
                </td> 
                <td class="px-2 py-4 capitalize">
                  {{event?.eventStatus}}
                </td> 
                <td class="py-4">
                  <tui-rating class="text-yellow-600"></tui-rating>
                </td>
                <td class="py-4 inline-flex gap-2">
                  <button
                    tuiIconButton
                    icon="tuiIconEdit"
                    type="submit"
                    appearance="custom"
                    size="s"
                    class="bg-[#1F566E] text-white"
                  >
                  </button>
                  <button
                    tuiIconButton
                    icon="tuiIconTrash2"
                    type="submit"
                    appearance="custom"
                    size="s"
                    class="bg-red-500 text-white"
                  >
                  </button>
                </td> 
              </tr>
            </ng-container>
          </ng-template>
        </tbody>
      </table>
      <div class="pt-10 pb-6">
        <tui-pagination
          [length]="data?.totalCount"
          [index]="index"
          (indexChange)="goToPage($event)"
        ></tui-pagination>
      </div>
    </div>
  </ng-container>

  <ng-template #loading>
    <tui-loader class="mt-14" [overlay]="false" size="xl" [inheritColor]="false"></tui-loader>
  </ng-template>
</app-layout>